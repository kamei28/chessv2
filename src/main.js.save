const { invoke } = window.__TAURI__.core;

let lastclick;
let selectedpiece = [null, 0];
// let greetInputEl;
// let greetMsgEl;

// async function greet() {
//   // Learn more about Tauri commands at https://tauri.app/develop/calling-rust/
//   greetMsgEl.textContent = await invoke("greet", { name: greetInputEl.value });
// }

/** 制作メモ
 * 駒の上書き
 * キャスリングやポーンの変換処理
 */

window.addEventListener("DOMContentLoaded", () => {
  let board = getid("board");

  /** マスのクリック処理 */
  board.addEventListener("click", async (event) => {
    let target = event.target;
    let parent = target.parentElement;

    console.log(selectedpiece);
console.log(target.tagName);

    /** 駒をクリックしたときの処理 */
    if (target.tagName.toLowerCase() === "img" && lastclick != parent.id && selectedpiece[1] == 0) {

      // 駒の選択を維持する 
      selectedpiece = [target, 1];
      
      // 駒がある場合は親要素を選択. ついでに移動範囲の表示(関数)
      getValidMoves(target.id, (target = parent).id);
    }
    
    /** 駒を移動させる処理 */
    if (selectedpiece && target != selectedpiece[0] && selectedpiece[1] == 2) {
      
      // 駒がある場合は削除して親要素を選択
      if (target.tagName.toLowerCase() === 'img') {
        target = parent;
        target.querySelector('img').remove();
      }

      target.appendChild(selectedpiece[0]);
      selectedpiece[1] = 3;

      // 駒移動のバグ防止
    } else if (selectedpiece[1] == 1) {
      selectedpiece[1] = 2;
    }

    /** 前回のクリック処理を撤廃する */
    if (lastclick) {
      getid(lastclick).classList.remove("selected");
    }

    console.log(selectedpiece);

    if (target.tagName.toLowerCase() == "div" && lastclick != target.id && selectedpiece[1] != 3) {
      target.classList.toggle("selected");
      lastclick = target.id;
      console.log(target.id);

    /** 連打バグ防止 */
    } else {
      selectedpiece = [null, 0];
      lastclick = null;
    }
  });

  console.log("ok1");
  return 0;
  greetInputEl = document.querySelector("#greet-input");
  greetMsgEl = document.querySelector("#greet-msg");
  document.querySelector("#greet-form").addEventListener("submit", (e) => {
    e.preventDefault();
    greet();
  });
});
